$(document).ready(function(){$("#generateRandom").click(function(a){a.preventDefault();$("#loader").show();toggleImgUrlField();$(".canvasImg").remove();$("#swatches").children().remove();$("#tt-color-combinations").hide();$("#demo").hide();$.ajax({url:"http://api.flickr.com/services/rest/?format=json&sort=random&method=flickr.photos.search&tags=animals,architecture,art,asia,color,music,beach,berlin,bike,bird&tag_mode=all&api_key=a114ec79080830ba6b3f6b16d253a144",type:"GET",crossDomain:true,dataType:"jsonp",timeout:10000,error:function(c,d,b){if(d==="timeout"){alert("Flikr is not responding, press OK to reload and try again.");window.location.reload()}}})});$(".useUrl").click(function(a){a.preventDefault();$(".urlError").hide();if($(".useUrl").hasClass("open")){t_url=$("#imgUrl").val();if(checkURL(t_url)){$(".canvasImg").remove();$("#swatches").children().remove();$(".urlError").hide();buildImg(t_url);printImg(t_url);checkImg(t_url);$("#tt-color-combinations").hide();$("#demo").hide();toggleImgUrlField()}else{}}else{$(this).text("Go!").next().slideToggle();$("#imgUrl").val("");$(this).addClass("open")}})});$(window).load(function(){$(".swatch").live("click",(function(){if($(this).children().hasClass("visible")){$(this).children().fadeOut(300);$(this).children().toggleClass("visible")}else{$(this).children().fadeIn(300);$(this).children().toggleClass("visible")}}));$("#imgUrl").keydown(function(b){if(b.keyCode==13){b.preventDefault();$(".useUrl").click()}});$(".swatch span").live("click",(function(b){b.stopPropagation();b.preventDefault()}));$(".error").live("click",(function(b){b.stopPropagation();b.preventDefault();$(this).fadeOut(300)}));var a=$(document).height();$("#page1").css("min-height",a);$(".moreInfo").live("click",function(){var b=$(this).prev().val();$(".swatch").removeClass("selected");$(this).parent().parent().addClass("selected");buildColorRelations(b)})});function checkURL(c){var a=c;var b=/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/;if(!b.test(a)){$(".urlError").fadeIn(300);return false}else{return true}}function buildImg(e){var d=document.getElementById("canvas");var b=d.getContext("2d");var c=new Image();var h=document.getElementById("info");var a=new Array();var g=true;var f="getImage.php?"+t_url;c.src=f;c.onload=function(){b.webkitImageSmoothingEnabled=true;b.drawImage(c,0,0,400,400);var n=b.getImageData(0,0,400,400);var v=n.data;for(var u=0;u<v.length;u+=4){var k=v[u]+","+v[u+1]+","+v[u+2]+","+v[u+3];if(a[k]){a[k]++}else{a[k]=1}}var o=sortAssoc(a);var q=0;var s=30;var j=[];var x=false;for(var y in o){var r=y.split(",");var l="";for(var u=0;u<3;u++){l+=decimalToHex(r[u],2)}x=true;for(var t in j){var w=0;var m=j[t].split(",");for(var u=0;u<=3;u++){w+=Math.abs(r[u]-m[u])}if(w/4<s){x=false;break}}if(x){var p="";if(l=="ffffff"){p="; color: #666"}$("#swatches").append('<li class="swatch" style="background: #'+l+p+';"><span class="colorhex visible"><input type="text" value="#'+l+'" readonly/><span class="moreInfo"><i class="icon-caret-down"></i></span></span></li>');j.push(y);q++}if(q>10){break}}}}function sortAssoc(c){var e=[];for(var d in c){e.push([d,c[d]])}e.sort(function(){return arguments[1][1]-arguments[0][1]});var b=[];for(var a=0;a<e.length;a++){b[e[a][0]]=e[a][1]}return b}function decimalToHex(c,b){var a=Number(c).toString(16);b=typeof(b)==="undefined"||b===null?b=2:b;while(a.length<b){a="0"+a}return a}function jsonFlickrApi(a){var c="";var b=Math.random();b=b*100;b=Math.ceil(b);photo=a.photos.photo[b];if(typeof photo=="undefined"){alert("Flikr is not responding, press OK to reload and try again.")}else{t_url="http://farm"+photo.farm+".static.flickr.com/"+photo.server+"/"+photo.id+"_"+photo.secret+"_d.jpg";p_url="http://www.flickr.com/photos/"+photo.owner+"/"+photo.id;buildImg();printImg(t_url);checkImg();$("#loader").hide()}}function checkImg(){var a=document.getElementById("pic");a.onerror=function(){$("#pic").hide();$(".urlError").fadeIn(300);return false};a.onload=function(){$("#imgUrl").val("");$("#pic").show();return true}}function toggleImgUrlField(){if($(".useUrl").hasClass("open")){$(".urlError").fadeOut(300);$(".imgUrlWrap").slideToggle();$(".useUrl").text("Extract from URL").removeClass("open")}}function printImg(a){makeItLocal=a;$(".imgWrap").append("<img src='"+makeItLocal+"' class='canvasImg bevel' id='pic' />")}function select(b){var c=window.getSelection();var a=c.getRangeAt(0);a.selectNode(b);c.addRange(a)}function buildColorRelations(a){myColor=a;colorChange(myColor);$("#tt-color-combinations").show();$("#demo").show()}function colorChange(g){var a=tinycolor(g);var e=["Hex: "+a.toHexString(),"RGB: "+a.toRgbString(),"HSL: "+a.toHslString(),"HSV: "+a.toHsvString(),"Name: "+(a.toName()||"none"),"Format: "+(a.format),"Format string: "+a.toString(),].join("\n");$("#code-output").text(e);$("#yourColor").css("background-color",a.toHexString());var c=$("#filter-output").toggleClass("invisible",!a.ok);c.find(".lighten").css("background-color",tinycolor.lighten(a,20).toHexString());c.find(".darken").css("background-color",tinycolor.darken(a,20).toHexString());c.find(".saturate").css("background-color",tinycolor.saturate(a,20).toHexString());c.find(".desaturate").css("background-color",tinycolor.desaturate(a,20).toHexString());c.find(".greyscale").css("background-color",tinycolor.greyscale(a).toHexString());var f=[];for(var h in tinycolor.names){f.push(h)}var b=tinycolor.mostReadable(g,f);$(".mostReadable").css("background-color",b.toHexString());var l=$("#combine-output").toggleClass("invisible",!a.ok);var m=tinycolor.triad(a);l.find(".triad").html($.map(m,function(i){return'<li class="swatch" style="background:'+i.toHexString()+'"><span class="visible">'+i.toHexString()+"</span></li>"}).join(""));var d=tinycolor.tetrad(a);l.find(".tetrad").html($.map(d,function(i){return'<li class="swatch" style="background:'+i.toHexString()+'"><span class="visible">'+i.toHexString()+"</span></li>"}).join(""));var j=tinycolor.monochromatic(a);l.find(".mono").html($.map(j,function(i){return'<li class="swatch" style="background:'+i.toHexString()+'"><span class="visible">'+i.toHexString()+"</span></li>"}).join(""));var n=tinycolor.analogous(a);l.find(".analogous").html($.map(n,function(i){return'<li class="swatch" style="background:'+i.toHexString()+'"><span class="visible">'+i.toHexString()+"</span></li>"}).join(""));var k=tinycolor.splitcomplement(a);l.find(".sc").html($.map(k,function(i){return'<li class="swatch" style="background:'+i.toHexString()+'"><span class="visible">'+i.toHexString()+"</span></li>"}).join(""))};